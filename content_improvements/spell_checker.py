"""
–§–∞–π–ª –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ä—Ñ–æ–≥—Ä–∞—Ñ–∏–∏ –≤ –ø–æ—Å—Ç–∞—Ö.

üîπ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—Å—Ç–∞: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `language_tool_python` –¥–ª—è –ø–æ–∏—Å–∫–∞ –æ—à–∏–±–æ–∫.
üîπ –ò—Å–∫–ª—é—á–µ–Ω–∏–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏—Ö —Ç–µ—Ä–º–∏–Ω–æ–≤: –ù–µ –∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç —Å–ª–æ–≤–∞ –∏–∑ —Å–ø–∏—Å–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–±–∏–æ—Ö–∞–∫–∏–Ω–≥", "–Ω–µ–π—Ä–æ–ø–ª–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—å").
üîπ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –ó–∞–º–µ–Ω—è–µ—Ç –æ—à–∏–±–∫–∏ –Ω–∞ –Ω–∞–∏–±–æ–ª–µ–µ –≤–µ—Ä–æ—è—Ç–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è.
üîπ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ: –§–∏–∫—Å–∏—Ä—É–µ—Ç —É—Å–ø–µ—à–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –∏–ª–∏ –æ—à–∏–±–∫–∏ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ.
"""

import language_tool_python
from logger import log_info, log_error

# üõ† –°–æ–∑–¥–∞—ë–º –æ–¥–∏–Ω –æ–±—ä–µ–∫—Ç LanguageTool (–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è)
tool = language_tool_python.LanguageTool("ru")

# üîç –°–ø–∏—Å–æ–∫ —Ç–µ—Ä–º–∏–Ω–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –ù–ï –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–ª—è—Ç—å
EXCLUDED_TERMS = {"–±–∏–æ—Ö–∞–∫–∏–Ω–≥", "–Ω–µ–π—Ä–æ–ø–ª–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—å", "–º–∏—Ç–æ—Ö–æ–Ω–¥—Ä–∏–∏", "–∞–¥–∞–ø—Ç–æ–≥–µ–Ω—ã",
                  "–¥–æ—Ñ–∞–º–∏–Ω", "—Å–µ—Ä–æ—Ç–æ–Ω–∏–Ω", "–Ω–µ–π—Ä–æ—Ç—Ä–∞–Ω—Å–º–∏—Ç—Ç–µ—Ä"}


def correct_text(text):
    """üîç –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∏ –∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç –æ—à–∏–±–∫–∏ –≤ —Ç–µ–∫—Å—Ç–µ, –Ω–æ –ù–ï –∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ—Ä–º–∏–Ω—ã –∏–∑ —Å–ø–∏—Å–∫–∞ EXCLUDED_TERMS."""
    try:
        matches = tool.check(text)
        for match in matches:
            if any(term in match.context for term in EXCLUDED_TERMS):
                continue  # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏—Ö —Ç–µ—Ä–º–∏–Ω–æ–≤
            text = text.replace(match.context, match.replacements[0] if match.replacements else match.context)
        log_info("‚úÖ –û—Ä—Ñ–æ–≥—Ä–∞—Ñ–∏—è –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ.")
        return text
    except Exception as e:
        log_error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –æ—Ä—Ñ–æ–≥—Ä–∞—Ñ–∏–∏: {e}")
        return text  # –ï—Å–ª–∏ –æ—à–∏–±–∫–∞, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç
