import random
from telegram import Bot
from keys import TELEGRAM_BOT_TOKEN, CHAT_ID
import asyncio
from logger import log_info, log_error

bot = Bot(token=TELEGRAM_BOT_TOKEN)

quiz_questions = [
    {
        "question": "–ö–∞–∫–æ–π –≥–æ—Ä–º–æ–Ω –Ω–∞–∑—ã–≤–∞—é—Ç '–≥–æ—Ä–º–æ–Ω–æ–º —Å—á–∞—Å—Ç—å—è'?",
        "options": ["–î–æ—Ñ–∞–º–∏–Ω", "–ê–¥—Ä–µ–Ω–∞–ª–∏–Ω", "–ö–æ—Ä—Ç–∏–∑–æ–ª", "–ú–µ–ª–∞—Ç–æ–Ω–∏–Ω"],
        "correct_index": 0,
        "explanation": "–î–æ—Ñ–∞–º–∏–Ω –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –º–æ—Ç–∏–≤–∞—Ü–∏—é, —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ –∏ —Ä–∞–¥–æ—Å—Ç—å. üòä"
    },
    {
        "question": "–ö–∞–∫–æ–µ –≤—Ä–µ–º—è —Å—É—Ç–æ–∫ –ª—É—á—à–µ –≤—Å–µ–≥–æ –¥–ª—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫?",
        "options": ["–£—Ç—Ä–æ", "–î–µ–Ω—å", "–í–µ—á–µ—Ä", "–ö–æ–≥–¥–∞ —É–¥–æ–±–Ω–æ"],
        "correct_index": 3,
        "explanation": "–ì–ª–∞–≤–Ω–æ–µ ‚Äî —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å. –ï—Å–ª–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∞—Ç—å—Å—è —Ä–µ–≥—É–ª—è—Ä–Ω–æ, –æ—Ä–≥–∞–Ω–∏–∑–º –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è!"
    },
    {
        "question": "–ö–∞–∫–æ–π –≤–∏—Ç–∞–º–∏–Ω –≤–∞–∂–µ–Ω –¥–ª—è –∫—Ä–µ–ø–∫–∏—Ö –∫–æ—Å—Ç–µ–π?",
        "options": ["–í–∏—Ç–∞–º–∏–Ω C", "–í–∏—Ç–∞–º–∏–Ω A", "–í–∏—Ç–∞–º–∏–Ω D", "–í–∏—Ç–∞–º–∏–Ω B12"],
        "correct_index": 2,
        "explanation": "–í–∏—Ç–∞–º–∏–Ω D —Å–ø–æ—Å–æ–±—Å—Ç–≤—É–µ—Ç —É—Å–≤–æ–µ–Ω–∏—é –∫–∞–ª—å—Ü–∏—è, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ–æ–±—Ö–æ–¥–∏–º –¥–ª—è –∫–æ—Å—Ç–µ–π."
    },
    {
        "question": "–ö–∞–∫–æ–π –Ω–∞–ø–∏—Ç–æ–∫ –ø–æ–º–æ–≥–∞–µ—Ç —É—Å–∫–æ—Ä–∏—Ç—å –æ–±–º–µ–Ω –≤–µ—â–µ—Å—Ç–≤?",
        "options": ["–°–ª–∞–¥–∫–∏–π —á–∞–π", "–ö–æ—Ñ–µ", "–ì–∞–∑–∏—Ä–æ–≤–∫–∞", "–¢—ë–ø–ª–∞—è –≤–æ–¥–∞ —Å –ª–∏–º–æ–Ω–æ–º"],
        "correct_index": 1,
        "explanation": "–ö–æ—Ñ–µ–∏–Ω –≤ –∫–æ—Ñ–µ —Å—Ç–∏–º—É–ª–∏—Ä—É–µ—Ç –æ–±–º–µ–Ω –≤–µ—â–µ—Å—Ç–≤ –∏ –ø–æ–≤—ã—à–∞–µ—Ç —É—Ä–æ–≤–µ–Ω—å —ç–Ω–µ—Ä–≥–∏–∏. ‚òï"
    },
    {
        "question": "–ö–∞–∫–æ–π —Ç–∏–ø –¥—ã—Ö–∞–Ω–∏—è –ø–æ–º–æ–≥–∞–µ—Ç –±—ã—Å—Ç—Ä–µ–µ —É—Å–ø–æ–∫–æ–∏—Ç—å—Å—è?",
        "options": ["–ì–ª—É–±–æ–∫–æ–µ –¥—ã—Ö–∞–Ω–∏–µ", "–ü–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–Ω–æ–µ –¥—ã—Ö–∞–Ω–∏–µ", "–ß–∞—Å—Ç–æ–µ –¥—ã—Ö–∞–Ω–∏–µ", "–î—ã—Ö–∞–Ω–∏–µ —á–µ—Ä–µ–∑ —Ä–æ—Ç"],
        "correct_index": 0,
        "explanation": "–ì–ª—É–±–æ–∫–æ–µ –¥—ã—Ö–∞–Ω–∏–µ —Å–Ω–∏–∂–∞–µ—Ç —É—Ä–æ–≤–µ–Ω—å —Å—Ç—Ä–µ—Å—Å–∞ –∏ –ø–æ–º–æ–≥–∞–µ—Ç —Ä–∞—Å—Å–ª–∞–±–∏—Ç—å—Å—è. üßò"
    }
]

used_questions = []  # ‚úÖ –°–ø–∏—Å–æ–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤

async def send_quiz():
    """üß† –û—Ç–ø—Ä–∞–≤–∫–∞ –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –æ—Ç–≤–µ—Ç–æ–º –∏ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ–º"""
    global used_questions

    # üîÑ –ï—Å–ª–∏ –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã, —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫
    if len(used_questions) == len(quiz_questions):
        used_questions = []

    # üîç –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –≤–æ–ø—Ä–æ—Å, –∫–æ—Ç–æ—Ä—ã–π –µ—â—ë –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è
    available_questions = [q for q in quiz_questions if q not in used_questions]
    question_data = random.choice(available_questions)
    used_questions.append(question_data)

    try:
        log_info(f"üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã: {question_data['question']}")  # ‚úÖ –õ–æ–≥–∏—Ä—É–µ–º –ø—Ä–æ—Ü–µ—Å—Å

        await bot.send_poll(
            chat_id=CHAT_ID,
            question=question_data["question"],
            options=question_data["options"],
            type="quiz",
            correct_option_id=question_data["correct_index"],
            is_anonymous=True
        )

        await asyncio.sleep(60)

        explanation = f"üì¢ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: {question_data['options'][question_data['correct_index']]}\n\nüí° {question_data['explanation']}"
        await bot.send_message(chat_id=CHAT_ID, text=explanation)

    except Exception as e:
        log_error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã: {e}")
