"""
–§–∞–π–ª –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é –ø–æ–∏—Å–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è –ø–æ–∏—Å–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.

üîπ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç OpenAI: –£–ª—É—á—à–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã, –¥–æ–±–∞–≤–ª—è—è —É—Ç–æ—á–Ω—è—é—â–∏–µ —Å–ª–æ–≤–∞ –∏ —Å–∏–Ω–æ–Ω–∏–º—ã.
üîπ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–º—ã—Å–ª: –ù–µ –∏–∑–º–µ–Ω—è–µ—Ç –∫–ª—é—á–µ–≤—É—é —Ç–µ–º—É, –∞ –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –±–æ–ª–µ–µ —Ç–æ—á–Ω—ã–º.
üîπ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ: –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∏ –æ—à–∏–±–∫–∏ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏.
üîπ –ó–∞—â–∏—Ç–∞ –æ—Ç —Å–±–æ–µ–≤: –ï—Å–ª–∏ AI –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å.
"""

import openai
from keys import OPENAI_API_KEY
from logger import log_info, log_error


def generate_search_keywords(query):
    """üîç AI-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π"""
    prompt = f"""
    –£–ª—É—á—à–∏ –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–∏—Å–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π. –î–æ–±–∞–≤—å —Å–∏–Ω–æ–Ω–∏–º—ã, —É—Ç–æ—á–Ω—è—é—â–∏–µ —Å–ª–æ–≤–∞,
    –Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏ —Å–º—ã—Å–ª. –ù–µ –¥–æ–±–∞–≤–ª—è–π –ª–∏—à–Ω–∏–µ —Å–ª–æ–≤–∞, —Ç–æ–ª—å–∫–æ —Ç–µ, —á—Ç–æ –ø–æ–º–æ–≥–∞—é—Ç –Ω–∞–π—Ç–∏ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ.

    –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å: "{query}"
    –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å:
    """

    try:
        response = openai.ChatCompletion.create(
            model="gpt-3.5-turbo",
            messages=[{"role": "user", "content": prompt}],
            api_key=OPENAI_API_KEY
        )
        improved_query = response["choices"][0]["message"]["content"].strip()
        log_info(f"üîç AI-–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å: {improved_query}")
        return improved_query

    except Exception as e:
        log_error(f"‚ùå –û—à–∏–±–∫–∞ AI-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–∞: {e}")
        return query  # –ï—Å–ª–∏ –æ—à–∏–±–∫–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å
